<html>
  <head>
	<meta charset="utf-8">
    <title>Calculadora Científica</title>
  </head>
  <body>
	<style>
		table {
			font-family: arial, sans-serif;
			border-collapse: collapse;
			margin-left: auto;
			margin-right: auto;
		}
		td, tr {
			border: 1px solid black;
			text-align: center;
			padding: 8px;
		}		
		textarea {
			font-family: arial, sans-serif;
			font-size: 16px;
			font-weight: bold;
			height: 30px;
		}
		.button {
			border: 1px solid black;
			color: black;
			padding: 6px 10px;
			text-align: center;
			text-decoration: none;
			display: inline-block;
			font-size: 14px;
			margin: 2px 2px;
			cursor: pointer;
			border-radius: 8px;
			font-weight: bold;
			/* width:45px; */
		}
		.buttonGray{
			border: 1px solid black;
			background-color: gray;
			color: white;
			padding: 6px 10px;
			text-align: center;
			text-decoration: none;
			display: inline-block;
			font-size: 14px;
			margin: 2px 2px;
			cursor: pointer;
			border-radius: 8px;
			font-weight: bold;
		}
		.buttonYellow {
			background-color: #fff175;
			font-size: 14px;
			font-weight: bold;
			padding: 6px 10px;
			color: black;
			border-radius: 8px;
		} 
		.buttonLightCyan {
			background-color: lightcyan; 
			font-size: 14px;
			font-weight: bold;
			padding: 6px 10px;
			color: black;
			border-radius: 8px;
		}
		.buttonLightGreen {
			background-color: lightgreen; 
			font-size: 14px;
			font-weight: bold;
			padding: 6px 10px;
			color: black;
			border-radius: 8px;
		}
		.buttonLightRed {
			background-color: lightcoral; 
			font-size: 14px;
			font-weight: bold;
			padding: 6px 10px;
			color: black;
			border-radius: 8px;
		}
	</style>
 
	<table>
		<tr>
			<td colspan="5"><textarea id="calcDisplay" rows="1" cols="30"></textarea></th>
		</tr>
		<tr>
			<td><button type="button" class="buttonYellow" onclick="appendDigit('X')">RX</button></td>
			<td><button type="button" class="buttonYellow" onclick="appendDigit('Y')">RY</button></td>
			<td><button type="button" class="buttonYellow" onclick="appendDigit('Z')">RZ</button></td>
			<td><button type="button" class="buttonLightCyan" onclick="prefixOperator('sin')">sin</button></td>
			<td><button type="button" class="buttonLightCyan" onclick="prefixOperator('cos')">cos</button></td>
		</tr>
		<tr>
			<td><button type="button" class="buttonYellow" onclick="storeVar('X')">SX</button></td>
			<td><button type="button" class="buttonYellow" onclick="storeVar('Y')">SY</button></td>
			<td><button type="button" class="buttonYellow" onclick="storeVar('Z')">SZ</button></td>
			<td><button type="button" class="buttonLightCyan" onclick="prefixOperator('tan')">tan</button></td>
			<td><button type="button" class="buttonLightCyan" onclick="prefixOperator('sec')">sec</button></td>
		</tr>
		<tr>
			<td><button type="button" class="buttonLightCyan" onclick="prefixOperator('log')">log</button></td>
			<td><button type="button" class="buttonLightCyan" onclick="prefixOperator('lg')">log2</button></td>
			<td><button type="button" class="buttonLightCyan" onclick="prefixOperator('ln')">ln</button></td>
			<td><button type="button" class="buttonLightCyan" onclick="suffixOperator('²')">x²</button></td>
			<td><button type="button" class="buttonLightCyan" onclick="prefixOperator('√')">√</button></td>
		</tr>
		<tr>
			<td><button type="button" class="buttonGray" onclick="appendDigit('7')">7</button></td>
			<td><button type="button" class="buttonGray" onclick="appendDigit('8')">8</button></td>
			<td><button type="button" class="buttonGray" onclick="appendDigit('9')">9</button></td>
			<td><button type="button" class="buttonLightCyan" onclick="appendOperator('x')">x</button></td>
			<td><button type="button" class="buttonLightCyan" onclick="suffixOperator('!')">X!</button></td>
		</tr>
		<tr>
			<td><button type="button" class="buttonGray" onclick="appendDigit('4')">4</button></td>
			<td><button type="button" class="buttonGray" onclick="appendDigit('5')">5</button></td>
			<td><button type="button" class="buttonGray" onclick="appendDigit('6')">6</button></td>
			<td><button type="button" class="buttonLightCyan" onclick="appendOperator('/')">/</button></td>
			<td><button type="button" class="buttonLightCyan" onclick="prefixOperator('inv')">1/x</button></td>
		</tr>
		<tr>
			<td><button type="button" class="buttonGray" onclick="appendDigit('1')">1</button></td>
			<td><button type="button" class="buttonGray" onclick="appendDigit('2')">2</button></td>
			<td><button type="button" class="buttonGray" onclick="appendDigit('3')">3</button></td>
			<td><button type="button" class="buttonLightCyan" onclick="appendOperator('+')">+</button></td>
			<td><button type="button" class="buttonLightCyan" onclick="wrapOperator('|')">|x|</button></td>
		</tr>
		<tr>
			<td><button type="button" class="button" onclick="prefixSign()">+/-</button></td>
			<td><button type="button" class="buttonGray" onclick="appendDigit('0')">0</button></td>
			<td><button type="button" class="button" onclick="appendDot('.')">.</button></td>
			<td><button type="button" class="buttonLightCyan" onclick="appendOperator('-')">-</button></td>
			<td><button type="button" class="buttonLightGreen" onclick="appendDigit('π')">π</button></td>
		</tr>
		<tr>
			<td><button type="button" class="buttonLightRed" onclick="clearAll('C')">C</button></td>
			<td><button type="button" class="buttonLightRed" onclick="clearNumber('CE')">CE</button></td>
			<td><button type="button" class="button" onclick="calculate('=')">=</button></td>
			<td><button type="button" class="buttonLightCyan" onclick="appendOperator('^')">^</button></td>
			<td><button type="button" class="buttonLightGreen" onclick="appendDigit('e')">e</button></td>
		</tr>
	</table>  
 
	<script>
		var arg1 = "";
		var arg2 = "";
		var oper = "";
		var answer = "";
		var X="";
		var Y="";
		var Z="";
		
		function activate(digit) {
			if (answer!="") {
				arg1 = ""; answer="";
			}
			if (oper!="")
				arg2 += digit;
			else
				arg1 += digit;	
			document.getElementById('calcDisplay').value = arg1 + " " + oper + " " + arg2;
		}

		function appendDigit(digit) {
			if (answer!="") {
				arg1 = ""; answer="";
			}
			if (oper!="")
				arg2 += digit;
			else
				arg1 += digit;	
			document.getElementById('calcDisplay').value = arg1 + " " + oper + " " + arg2;
		}		
		function appendOperator(operator) {
			if (oper!="")
				return;
			oper = operator;
			operatorType = "binary";
			answer="";
			document.getElementById('calcDisplay').value = arg1 + " " + oper + " " + arg2;
		}
		function suffixOperator(operator){
			if(arg1=="" || oper!="")
				return;
			oper = operator;
			operatorType = "unary";
			answer="";
			document.getElementById('calcDisplay').value = arg1 + " " + oper;
		}
		function prefixOperator(operator){
			arg1="", result="";
			oper = operator;
			operatorType = "unary";
			answer="";
			document.getElementById('calcDisplay').value = arg1 + " " + oper;
		}

		function wrapOperator(operator){
			if(arg1=="" || oper!="")
				return;
			oper = operator;
			operatorType = "unary";
			answer="";
			document.getElementById('calcDisplay').value = oper + " " + arg1 + " " + oper;
		}

		function clearAll() {
			arg1 = ""; arg2 = ""; answer = ""; oper = "";
			document.getElementById('calcDisplay').value = arg1 ;
		}		
		function clearNumber() {
			if (oper!="")
				arg2 = "";
			else
				arg1 = "";
			answer = "";
			document.getElementById('calcDisplay').value = arg1 + " " + oper + " " + arg2;
		}		
		function prefixSign() {
			if (oper!="") {
				if (arg2 == "")
					arg2 = '-';
				else if (arg2.charAt(0)=="-")
					arg2 = arg2.slice(1);				
				else
					arg2 = '-'+arg2;
			} else {
				if (arg1 == "")
					arg1 = '-';
				else if (arg1.charAt(0)=="-")
					arg1 = arg1.slice(1);				
				else
					arg1 = '-'+arg1;
			}
			answer = "";
			document.getElementById('calcDisplay').value = arg1 + " " + oper + " " + arg2;
		}		
		
		function appendDot() {
			if (oper!="") {
				if (arg2!="" && arg2.indexOf(".")==-1)
					arg2 += ".";
			} else { 
				if (arg1!="" && arg1.indexOf(".")==-1)
					arg1 += ".";
			}
			answer = "";
			document.getElementById('calcDisplay').value = arg1 + " " + oper + " " + arg2;
		}		

		async function storeVar(varRead){
			if (oper!="" || arg1=="")
				return;
			if (varRead == "X")
				X=arg1
			else if (varRead == "Y")
				Y=arg1
			else if (varRead == "Z")
				Z=arg1

			document.getElementById('calcDisplay').value = "number stored in " + varRead + "!";

			try {
					oper="var";
					const response = await fetch(`http://localhost:8080/wscalc/?op=${oper}&n1=${varRead}&n2=${arg1}`);
					if (!response.ok) {
						throw new Error(`Erro: ${response.status} ${response.statusText}`);
					}
					result = await response.text();
					document.getElementById("calcDisplay").innerText = result;
				} catch (error) {
					document.getElementById("calcDisplay").innerText = error.message;
				}

				answer="",arg1="",arg2="";
		}

		async function calculate() {
			const symbolToNum={
				"e":Math.E,
				"π":Math.PI,
				"X":X,
				"Y":Y,
				"Z":Z
			}
			const symbolList=["e","π","X","Y","Z"]

			if ((oper=="" || arg1=="") && (oper=="" || arg2==""))
				return;

			if (symbolList.includes(arg1)){
				arg1=symbolToNum[arg1]
			}
			if (symbolList.includes(arg2)){
					arg2=symbolToNum[arg2];
				}
			let result = NaN;
			let val1 = NaN;
			let val2 = NaN;

			if (operatorType == "unary"){
				if (arg1 == ""){
					val2 = parseFloat(arg2);
				} else if (arg2 == ""){
					val1 = parseFloat(arg1);
				}
			} else if (operatorType == "binary"){
				val1 = parseFloat(arg1);
				val2 = parseFloat(arg2);
			}
			
			const opToString = {
				"+":"add",
				"-": "sub",
 				"x": "mul",
  				"/": "div",
				"^": "pow",
				"|": "abs",
				"²": "sq",
				"√": "sqrt",
				"!": "fat",
				"sin": "sin",
				"cos":"cos",
				"tan":"tan",
				"sec":"sec",
				"inv":"inv",
				"log":"log",
				"ln":"ln",
				"lg":"lg"
			}
			
			if (!isNaN(val1) || !isNaN(val2)) {
				if (isNaN(val1))
					val1 = "und"
				else if (isNaN(val2))
					val2 = "und"
				try {
					oper=opToString[oper];
					const response = await fetch(`http://localhost:8080/wscalc/?op=${oper}&n1=${val1}&n2=${val2}`);
					if (!response.ok) {
						throw new Error(`Erro: ${response.status} ${response.statusText}`);
					}
					result = await response.text();
					document.getElementById("calcDisplay").innerText = result;
				} catch (error) {
					document.getElementById("calcDisplay").innerText = error.message;
				}
			}
			if (isNaN(result))
				answer = "Error!";
			else
				answer = result.toString();
			document.getElementById('calcDisplay').value = answer;
			arg1 = answer; arg2 = ""; oper = "";
		}
	</script>
  </body>
</html>